From beae0a8a39d4b4f1f0ba948b33a61a0a0c7c34c0 Mon Sep 17 00:00:00 2001
From: Eric Soroos <eric@derilinx.com>
Date: Tue, 3 Apr 2018 10:06:04 +0000
Subject: [PATCH 13/18] Filter duplicate activities in
 ckan/lib/email_notifications.py

---
 ckan-home/ckan/lib/email_notifications.py | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/ckan/lib/email_notifications.py b/ckan/lib/email_notifications.py
index 61f24b6..2445a85 100644
--- a/ckan/lib/email_notifications.py
+++ b/ckan/lib/email_notifications.py
@@ -270,6 +270,16 @@ def _notifications_from_dashboard_activity_list(user_dict, since):
     activity_list = [activity for activity in activity_list
             if strptime(activity['timestamp'], fmt) > since]
 
+    # Filter out duplicate activities:
+    id_set = set()
+    unfiltered_list = activity_list
+    activity_list = []
+    for activity in unfiltered_list:
+        if activity['object_id'] in id_set:
+            continue
+        activity_list.append(activity)
+        id_set.add(activity['object_id'])
+    
     return _notifications_for_activities(activity_list, user_dict)
 
 
-- 
2.7.4

